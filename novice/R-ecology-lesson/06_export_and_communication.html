<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="A.Bailey" />


<title>Exporting and communicating</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="01_R_and_Rstudio.html">R and RStudio</a>
</li>
<li>
  <a href="02_intro_to_R.html">Getting started</a>
</li>
<li>
  <a href="03_import_and_inspect.html">Importing data</a>
</li>
<li>
  <a href="04_transforming_data.html">Transforming data</a>
</li>
<li>
  <a href="05_visualising_data.html">Visualising data</a>
</li>
<li>
  <a href="06_export_and_communication.html">Communication</a>
</li>
<li>
  <a href="07_ecology_data_overview.html">Rodent Survey Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Southampton-RSG/2017-08-01-southampton-dc/tree/gh-pages/novice/R-ecology-lesson">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exporting and communicating</h1>
<h4 class="author"><em>A.Bailey</em></h4>

</div>


<hr />
<blockquote>
<h3 id="learning-objectives">Learning Objectives</h3>
<p>In this lesson the learner will:</p>
<ul>
<li>Turn the R script they have created into a shareable report.</li>
<li>Export data for sharing in CSV format.</li>
<li>Export figures in pdf or png format.</li>
</ul>
</blockquote>
<hr />
<div style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
<div class="figure">
<img src="img/data_workflow_comm.png" />

</div>
</div>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>Recall that we began with a data set of around 35,000 observations covering 40 species spread over 24 plots.</p>
<p>We have imported and transformed the data to both subset the observations and variables of interest, and to summarise the data. We then plotted the summarised data. We did this all in a R script.</p>
<p>As mentioned at the start, it’s good to think of the script as the reality of the analysis. It contains all the code necessary to reproduce the analysis, and unless we change the code or the data we import, it should reproduce it exactly every time we run the code. So it’s a really important document.</p>
<p>However, not everyone can use R, and we might wish to communicate the analysis outside of the R environment. Therefore we need to be able to export data too.</p>
<p>Here we’ll briefly cover three aspects of exporting:</p>
<ul>
<li>exporting data in spreadsheet form</li>
<li>exporting figures for use in documents or presentations</li>
<li>turning our script into a report</li>
</ul>
<p>This last point is particularly useful in situations such as writing a dissertation or manuscript where you might need to include the code you used in an analysis.</p>
</div>
<div id="exporting-data" class="section level2">
<h2>Exporting data</h2>
<p>The simplest way to export data for excel is to output our data frame as comma separated variable (.csv). We can either do this using <code>write_csv</code> for a general csv format, or in an excel specific csv format <code>write_excel_csv()</code>.</p>
<p>In my project directory I’ve created a folder called <code>data_output</code> to export files to.</p>
<p>The write functions can take a number of arguments, but in the simplest form we need to provide the name of the data frame we’re exporting, <code>surveys_subset</code> and a character string for the location and file name we want to save. Here that’s <code>&quot;data_output/surveys_subset.csv&quot;</code>. The forward slash indicates the file is going in the <code>data_output</code> folder.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write surveys in csv format</span>
<span class="kw">write_csv</span>(surveys_subset,<span class="st">&quot;data_output/surveys_subset.csv&quot;</span>)
<span class="co"># Write out an excel formatted csv</span>
<span class="kw">write_excel_csv</span>(surveys_subset,<span class="st">&quot;data_output/surveys_subset_excel.csv&quot;</span>)</code></pre></div>
<p>Having run the code, can open the files up to have a look.</p>
<p>There’s lots more information on data export here: <a href="https://cran.r-project.org/doc/manuals/r-release/R-data.html">R Data Import/Export</a>.</p>
</div>
<div id="exporting-figures" class="section level2">
<h2>Exporting figures</h2>
<p>Another common task is to export figures for presentations or to put in a document. Two common formats are portable network graphics (.png), good for PowerPoint, and portable document format (.pdf), good for high quality documents.</p>
<p>The best way to export figures in R is using code that opens a file in the format you require, makes the plot, and then you close the file. <strong>It’s important to remember to close the file.</strong></p>
<p>First we’re going to create our plot as an object instead of plotting directly as we did before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create the plot as an object called pub_plot</span>
pub_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> by_quarter,
                   <span class="kw">aes</span>(<span class="dt">x=</span>quarter, <span class="dt">y=</span>captures, <span class="dt">linetype =</span> plot_type,
                             <span class="dt">shape =</span> plot_type)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>rodent_type, <span class="dt">nrow =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1978</span>,<span class="dv">1990</span>,<span class="dv">2</span>)) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span><span class="st">&quot;YEAR&quot;</span>,
       <span class="dt">y =</span><span class="st">&quot;CAPTURES / PERIOD&quot;</span>,
       <span class="dt">linetype =</span> <span class="st">&quot;&quot;</span>,
       <span class="dt">shape =</span> <span class="st">&quot;&quot;</span>) +
<span class="st">  </span><span class="kw">theme_linedraw</span>() +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),
        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),
        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>),
        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),
        <span class="dt">aspect.ratio =</span> <span class="fl">0.6</span>, 
        <span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</code></pre></div>
<p>Now we have our figure as an object called <code>pub_plot</code> we can plot it to any format we wish, just by calling the object.</p>
<p>Here are two bits of code for exporting the same figure as a png and as a pdf.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Write out a png of the figure
<span class="co"># Open a png file and give it a name</span>
<span class="kw">png</span>(<span class="st">&quot;fig_output/capture_of_rodents.png&quot;</span>)
<span class="co"># Create the plot</span>
pub_plot
<span class="co"># Close the file</span>
<span class="kw">dev.off</span>()

<span class="co"># Write out a pdf of the figure</span>
<span class="co"># Open a pdf file</span>
<span class="kw">pdf</span>(<span class="st">&quot;fig_output/capture_of_rodents.pdf&quot;</span>)
<span class="co"># Create the plot</span>
pub_plot
<span class="co"># Close the file</span>
<span class="kw">dev.off</span>()</code></pre></div>
<p>Both these functions can take lots of other arguments, so check out <code>?png</code> and <code>?pdf</code> for more details.</p>
</div>
<div id="compiling-scripts-into-reports" class="section level2">
<h2>Compiling scripts into reports</h2>
<p>Finally, we can turn our code into a report. This is one reason why good comments are important, as our comments become the text of the report. By writing the analysis code and the report at the same time can save us duplicating our efforts.</p>
<p>For a more sophisticate approach, check out the <a href="http://r4ds.had.co.nz/r-markdown.html">R Markdown chapter</a> of R for Data Science. Here we’ll do a simplified approach.</p>
<p>At the top of our script, insert some comments lines in the following form:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; ---</span>
<span class="co">#&#39; title: &quot;Name of report&quot;</span>
<span class="co">#&#39; author: &quot;Your name&quot;</span>
<span class="co">#&#39; date: &quot;Today&#39;s date&quot;</span>
<span class="co">#&#39; ---</span></code></pre></div>
<p>Note the <code>#'</code> form of the comment line, with an apostrophe, this tells R to interpret this code to create the report header when we compile the script.</p>
<p>In the rest of the script we can use <code>#'</code> to create comments we want to be converted to regular text when we compile the script. Putting nothing after the <code>#'</code> creates a blank line.</p>
<p>We can also create headings, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; This would be a line of regular text</span>
<span class="co">#&#39;</span>
<span class="co">#&#39;# A big heading</span>
<span class="co">#&#39;</span>
<span class="co">#&#39;## A smaller heading</span>
<span class="co">#&#39;</span>
<span class="co">#&#39;### An even smaller heading</span></code></pre></div>
<p>This form: <code>#+</code>, can be used for controlling figure sizes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#+ fig.height=10</span>
pub_plot</code></pre></div>
<p>Take a moment to insert some of these kinds of comments into your script, our example is below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; ---</span>
<span class="co">#&#39; title: &quot;Competition in Desert Rodents&quot;</span>
<span class="co">#&#39; author: A. Bailey </span>
<span class="co">#&#39; date: 21st June 2017</span>
<span class="co">#&#39; ---</span>

<span class="co">#&#39; This script recapitulates some of the analysis found in the 1994 paper by </span>
<span class="co">#&#39; Heske et. al., Long-Term Experimental Study of a Chihuahuan Desert Rodent </span>
<span class="co">#&#39; Community: 13 Years of Competition, DOI: 10.2307/1939547.</span>
<span class="co">#&#39;</span>
<span class="co">#&#39; This paper examined the effect on the populations of small seed eating rodents</span>
<span class="co">#&#39; as a result of the exclusion of larger competitor kangeroo rats over a period </span>
<span class="co">#&#39; from 1977 to 1991.</span>
<span class="co">#&#39;</span>
<span class="co">#&#39;### Load the tidyverse set of packages</span>
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(forcats)

<span class="co">#&#39;### Read in the data</span>
<span class="co">#&#39; Assuming the data has been downloaded to the data folder:</span>
surveys &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;../data/portal_data_joined.csv&#39;</span>)

<span class="co">#&#39; This data has 34,786 observations of 13 variables.</span>
<span class="co">#&#39; #&#39;</span>
<span class="co">#&#39; We only need the observations for 8 species and 8 plots.</span>
<span class="co">#&#39;</span>
<span class="co"># Kangeroo Rats:</span>
<span class="co"># DM    Dipodomys merriami          Rodent  Merriam&#39;s kangaroo rat</span>
<span class="co"># DO    Dipodomys ordii             Rodent  Ord&#39;s kangaroo rat</span>
<span class="co"># DS    Dipodomys spectabilis       Rodent  Banner-tailed kangaroo rat</span>

<span class="co"># Granivores:</span>
<span class="co"># PP    Chaetodipus penicillatus    Rodent  Desert pocket mouse</span>
<span class="co"># PF    Perognathus flavus          Rodent  Silky pocket mouse</span>
<span class="co"># PE    Peromyscus eremicus         Rodent  Cactus mouse</span>
<span class="co"># PM    Peromyscus maniculatus      Rodent  Deer Mouse</span>
<span class="co"># RM    Reithrodontomys megalotis   Rodent  Western harvest mouse</span>

<span class="co"># Create a vector for the experimental plots, four controls, four kangeroo rat</span>
<span class="co"># exclusion plots</span>
exp_plots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">3</span>,<span class="dv">15</span>,<span class="dv">19</span>,<span class="dv">21</span>)

<span class="co"># Create a character vector for rodents of interest</span>
rodents &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;DM&quot;</span>,<span class="st">&quot;DO&quot;</span>,<span class="st">&quot;DS&quot;</span>,<span class="st">&quot;PP&quot;</span>,<span class="st">&quot;PF&quot;</span>,<span class="st">&quot;PE&quot;</span>,<span class="st">&quot;PM&quot;</span>,<span class="st">&quot;RM&quot;</span>)
<span class="co"># Create a character vector for Kangeroo Rats by subsetting the first</span>
<span class="co"># three elements of rodents</span>
krats &lt;-<span class="st"> </span>rodents[<span class="dv">1</span>:<span class="dv">3</span>]

<span class="co">#&#39;###Subset the data</span>
surveys_subset &lt;-<span class="st"> </span>surveys %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># Filter observations from 1977 to 1990, for the 3 K-rats and 5 granivores, </span>
<span class="st">  </span><span class="co"># and for the 4 experimental plots</span>
<span class="st">  </span><span class="kw">filter</span>(year &lt;=<span class="st"> </span><span class="dv">1990</span>,                    
         species_id %in%<span class="st"> </span>rodents,         
         plot_id %in%<span class="st"> </span>exp_plots) %&gt;%<span class="st">      </span>
<span class="st">  </span><span class="co"># Make variable to indicate whether species is K-rat or Granivore</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rodent_type =</span> <span class="kw">if_else</span>(species_id %in%<span class="st"> </span>krats, <span class="st">&quot;Kangeroo Rat&quot;</span>,
                               <span class="st">&quot;Granivore&quot;</span>),
         <span class="co"># Make combined date variable</span>
         <span class="dt">date =</span> lubridate::<span class="kw">dmy</span>(<span class="kw">sprintf</span>(<span class="st">&#39;%02d%02d%04d&#39;</span>, 
                                       day, month, year)),
         <span class="co"># Add the quartley period</span>
         <span class="dt">quarter =</span> lubridate::<span class="kw">quarter</span>(date,<span class="dt">with_year =</span> <span class="ot">TRUE</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># Drop unwanted variables</span>
<span class="st">  </span><span class="kw">select</span>(-sex,-hindfoot_length,-weight)

<span class="co">#&#39;### Summarise data </span>
<span class="co"># Summarise the data by rodent type, quarterly survey and plot type</span>
by_quarter &lt;-<span class="st"> </span>surveys_subset %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(rodent_type,quarter,plot_type) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">captures =</span> <span class="kw">n</span>()/<span class="dv">3</span>) 

<span class="co">#&#39;### Plot the data </span>
<span class="co"># Create rodent levels by getting the unique values for rodent type</span>
<span class="co"># and putting them in reverse order for plotting</span>
rodent_levels &lt;-<span class="st">  </span><span class="kw">rev</span>(<span class="kw">unique</span>(by_quarter$rodent_type))

<span class="co"># Convert rodent_type to factors such that Kangeroo rat is first and Granivore</span>
<span class="co"># is second</span>
by_quarter$rodent_type &lt;-<span class="st"> </span><span class="kw">factor</span>(by_quarter$rodent_type, 
                                 <span class="dt">levels =</span> rodent_levels)

<span class="co"># Now recreate the published figure in black and white</span>
pub_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> by_quarter,
                   <span class="kw">aes</span>(<span class="dt">x=</span>quarter, <span class="dt">y=</span>captures, <span class="dt">linetype =</span> plot_type,
                             <span class="dt">shape =</span> plot_type)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>rodent_type, <span class="dt">nrow =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1978</span>,<span class="dv">1990</span>,<span class="dv">2</span>)) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span><span class="st">&quot;YEAR&quot;</span>,
       <span class="dt">y =</span><span class="st">&quot;CAPTURES / PERIOD&quot;</span>,
       <span class="dt">linetype =</span> <span class="st">&quot;&quot;</span>,
       <span class="dt">shape =</span> <span class="st">&quot;&quot;</span>) +
<span class="st">  </span><span class="kw">theme_linedraw</span>() +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),
        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),
        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>),
        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),
        <span class="dt">aspect.ratio =</span> <span class="fl">0.6</span>, 
        <span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)

<span class="co">#+ fig.height=10</span>
pub_plot

<span class="co">#&#39;### Export the data and figure</span>
<span class="co">#&#39; Export the subsetted data as a excel readable csv file</span>
<span class="co">#&#39; and export the figure as pdf.</span>
<span class="co">#&#39; </span>
<span class="co"># Write out an excel formatted csv</span>
<span class="kw">write_excel_csv</span>(surveys_subset,<span class="st">&quot;data_output/surveys_subset_excel.csv&quot;</span>)
<span class="co"># Write out a pdf of the figure</span>
<span class="kw">pdf</span>(<span class="st">&quot;fig_output/capture_of_rodents.pdf&quot;</span>)
pub_plot
<span class="kw">dev.off</span>()</code></pre></div>
<p>When we’re ready we can now <em>knit</em> our scripts to a choice of several formats. Go to <code>File</code> &gt; <code>Knit Document</code> and we’ll be asked to choose an output. Stick with HTML and press <code>Compile</code>.</p>
<p>Once it has compiled, you should see a html file in your file window. Click on it and choose <code>View in Web Browser</code>.</p>
<p>Try compiling again, but choose a different format.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>In this lesson we’ve followed the data workflow to import data from a spreadsheet, transformed it by learning how to filter observations, select variables and create new variables and then summarise the observations. We then visualised our summarised data in several ways and reproduced the general finding that smaller granivore populations are affected by kangaroo rat abundance.</p>
<p>In this last section we’ve looked at how the analysis can be communicated by exporting the summary data, figures and reports.</p>
<p>All of these steps are common to many data sets, so hopefully you can build upon the methods covered here to increase the speed of your analysis, the robustness of your analysis, and your ability to communicate you understanding to others.</p>
</div>

<hr/>

<p><a href="http://datacarpentry.org/">Data Carpentry</a>, 2017. <br/>
  <a href="LICENSE.html">License</a>. Questions?  Feedback?
  Please <a href="https://github.com/datacarpentry/R-ecology-lesson/issues/new">file
    an issue on GitHub</a>. <br/>
  On Twitter: <a href="https://twitter.com/datacarpentry">@datacarpentry</a></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
