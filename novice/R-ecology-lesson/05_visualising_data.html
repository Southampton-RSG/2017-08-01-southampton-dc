<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Alistair Bailey" />


<title>Data visualisation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="01_R_and_Rstudio.html">R and RStudio</a>
</li>
<li>
  <a href="02_intro_to_R.html">Getting started</a>
</li>
<li>
  <a href="03_import_and_inspect.html">Importing data</a>
</li>
<li>
  <a href="04_transforming_data.html">Transforming data</a>
</li>
<li>
  <a href="05_visualising_data.html">Visualising data</a>
</li>
<li>
  <a href="06_export_and_communication.html">Communication</a>
</li>
<li>
  <a href="07_ecology_data_overview.html">Rodent Survey Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Southampton-RSG/2017-08-01-southampton-dc/tree/gh-pages/novice/R-ecology-lesson">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data visualisation</h1>
<h4 class="author"><em>Alistair Bailey</em></h4>

</div>


<hr />
<blockquote>
<h3 id="learning-objectives">Learning Objectives</h3>
<p>In this lesson the learner will:</p>
<ul>
<li>Use geometrical objects and aesthetic mappings to produce time series plots, boxplots and bar charts.</li>
<li>Use facets to create subplots of data.</li>
<li>Use factors and statistical mappings to transform plots.</li>
<li>Make positional and coordinate adjustments to transform plots.</li>
<li>Use themes to customize plots</li>
</ul>
</blockquote>
<hr />
<div style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
<div class="figure">
<img src="img/data_project_pipeline_vis.png" />

</div>
</div>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>We’ve transformed the surveys data ready for plotting, but what do we want to plot?</p>
<p>We want to plot the number of captures as a function of quarter in which they took place, whilst comparing both kangaroo rats and granivores, as well as comparing kangaroo rat exclosure with plots containing kangaroo rats and granivores.</p>
<p>Such a plot should inform us about the effect of kangaroo rat exclosure on the granivore population. All the work we did to transform the data should make this straight forward as we have a tidy data set i.e. each observation forms a row and each variable forms a column. We have four variables: <code>rodent_type</code>, <code>quarter</code>, <code>plot_type</code> and <code>captures</code>.</p>
<p>Here’s the figure from the paper again for reference:</p>
<div class="figure">
<img src="./img/HeskeBrown&amp;Mistry1994E_Fig_1.png" alt="Figure 1 from Heske et. al., 1994" />
<p class="caption">Figure 1 from Heske et. al., 1994</p>
</div>
</div>
<div id="reproducing-the-time-series" class="section level2">
<h2>Reproducing the time series</h2>
<p>Let’s remind ourselves of the basic form for creating plots with the <code>ggplot2</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> &lt;DATA&gt;) +<span class="st"> </span>
<span class="st">  </span><span class="er">&lt;</span><span class="kw">GEOM_FUNCTION</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(&lt;MAPPINGS&gt;))&gt;</code></pre></div>
<p>In this form we provide a data frame as an argument to the <code>ggplot</code> function and then aesthetics (the variables we wish to plot) are mapped to a geometric object such as a line. If we were to plot several <code>geoms()</code> on the same plot, we’d need to map the aesthetics to each <code>geom()</code>, so often it’s more convenient to provide the aesthetics argument to <code>ggplot()</code> instead, and it will be mapped to all geoms we add to the plot. Only do this if this is what you want.</p>
<p>In our first attempt at plotting the data, our data is <code>by_quarter</code> and we’ll map three aesthetics <code>x = quarter,y = captures,colour = plot_type</code> to two geoms <code>geom_line</code> and <code>geom_point</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> by_quarter,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> quarter,<span class="dt">y =</span> captures,<span class="dt">colour =</span> plot_type)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="img/r-lesson-by_quarter_1-1.png" width="960" /></p>
<p>This isn’t much use as we can’t tell the difference between the kangaroo rats and granivores. We need to use our fourth variable <code>rodent_type</code> to create two plots, one for the granivores and the other for the kangaroo rats.</p>
<div id="facets" class="section level3">
<h3>Facets</h3>
<p>Creating sub-plots based on the <code>rodent_type</code> variable uses facets. If we are faceting plots by a single variable we use <code>facet_wrap()</code>. The first argument is <code>~</code> followed by the variable name, here <code>rodent_type</code>. This argument is called a formula. There are many additional arguments that can be provided, see <code>?facet_wrap</code>.</p>
<p>Using <code>facet_wrap(~ rodent_type)</code> gives us this plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> by_quarter,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>quarter,<span class="dt">y=</span>captures,<span class="dt">colour=</span>plot_type)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>rodent_type)</code></pre></div>
<p><img src="img/r-lesson-by_quarter_2-1.png" width="960" /></p>
<p>So this is starting to look more like the published figure, and <strong>now we can confirm that the granivore populations do increase when the kangaroo rats are excluded.</strong></p>
<p>However we can improve things, and we’ll come back making the figure more polished at the end of this lesson.</p>
<p>If we wanted to plot the combination of two variables we’d use <code>facet_grid()</code> in which the formula becomes <code>first_variable ~ second_variable</code>.</p>
<blockquote>
<h3 id="challenge">Challenge</h3>
<p>Try plotting <code>by_quarter</code> using <code>facet_grid()</code> with the variables <code>plot_type</code> and <code>rodent_type</code> as arguments as described above for plotting the combination of two variables</p>
<p>We don’t need to map the colour aesthetic. The plot should look like the one below:</p>
</blockquote>
<p><img src="img/r-lesson-by_quarter_3-1.png" width="672" /></p>
</div>
</div>
<div id="other-plot-types" class="section level2">
<h2>Other plot types</h2>
<p>There are many other types of plot we may wish to create when exploring data. The previous plot showed us changes with time, but we might want to look at averages and spread or other statistical summaries of the data.</p>
<div id="boxplots" class="section level3">
<h3>Boxplots</h3>
<p>Box-plots are a standard way to plot the distribution of a data set. Plotting the data this way means that we drop the dynamic information, the time dimension, but gain a compact summarised view of the variability of the number of captures.</p>
<p>In the following code we use the <code>boxplot()</code> geom, and this time swap the mapping such that colour maps to the rodent type, and plots are faceted according to the plot type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span> by_quarter,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rodent_type, <span class="dt">y =</span> captures, 
                     <span class="dt">colour =</span> rodent_type)) +
<span class="st">  </span><span class="kw">geom_boxplot</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>plot_type)</code></pre></div>
<p><img src="img/r-lesson-by_quarter_box_1-1.png" width="672" /></p>
</div>
<div id="position-adjustments" class="section level3">
<h3>Position adjustments</h3>
<p>Another common adjustment we might make to our plots is to adjust the position of the data.</p>
<p>Recall the <code>mpg</code> data set for cars and our plot showing the fuel efficiency versus the size of the engine. Many of the points are actually over plotted such that we can’t see them.</p>
<p>By adding a bit of random noise to the position each data point, called <code>jitter</code> we can spread the points out and see them more clearly. This is seen in the second plot below, where the <code>postion = &quot;jitter&quot;</code> argument has been provided to the <code>geom_point()</code> function.</p>
<p>It’s a little counter intuitive to add noise to a plot, but when we’re trying to explore data for patterns it can be very useful.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Without jitter</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> class))</code></pre></div>
<p><img src="img/r-lesson-mpg_jitter-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># With jitter</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> class),
             <span class="dt">position =</span> <span class="st">&quot;jitter&quot;</span>)</code></pre></div>
<p><img src="img/r-lesson-mpg_jitter-2.png" width="672" /></p>
<p>Let’s add points to our box-plot and for the challenge try comparing the plot to one where the points are jittered.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Boxplot without jitter</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span> by_quarter,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rodent_type, <span class="dt">y =</span> captures, 
                     <span class="dt">colour =</span> rodent_type)) +
<span class="st">  </span><span class="kw">geom_boxplot</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>plot_type)</code></pre></div>
<p><img src="img/r-lesson-by_quarter_box_2-1.png" width="672" /></p>
<blockquote>
<h3 id="challenge-1">Challenge</h3>
<p>Plot the previous boxplot with jittered points</p>
<p>The plot should look like the one below.</p>
</blockquote>
<p><img src="img/r-lesson-by_quarter_box_3-1.png" width="672" /></p>
</div>
<div id="statistical-transformations" class="section level3">
<h3>Statistical transformations</h3>
<p>Next we’ll plot bar charts.</p>
<p>These simple plots actually reveal subtleties in plots. In the following code we take the <code>by_month_genus</code> subset and create a bar chart of <code>genus</code>, filling the bars with colour according to <code>rodent_type</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a bar plot of genus from by_month_genus </span>
<span class="kw">ggplot</span>(by_month_genus) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> genus, <span class="dt">fill=</span>rodent_type)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(~<span class="st"> </span>plot_type)</code></pre></div>
<p><img src="img/r-lesson-by_month_bar_1-1.png" width="672" /></p>
<p>We see that the code has automatically created a count variable on the y-axis for each genus plotted as a bar on the x-axis. (We’ll come back to the issue of illegible labels shortly.)</p>
<p>This is because the <code>geom_bar()</code> algorithm automatically performs a statistical transformation of the mapped variable. That is to say it performs a count and bins the data according to the genus. This means we have a chart where the bar height corresponds to the number of rows for each genus.</p>
<p>But this isn’t a count of the captures, it’s how many rows each genus appears in of <code>by_month_genus</code>. Remember how we summarised this data to calculate captures per month.</p>
<p>Often when people talk about bar charts they are referring to when the height of the bar is a variable present in the data, here that would be the <code>captures</code> column. In this kind of situation we need to map the y-axis too, and change the default <code>geom_bar()</code> statistical transformation to <code>stat = &quot;identity&quot;</code> so that it takes the values provided in the <code>captures</code> column to determine the height of the bar.</p>
<p>To reiterate: <strong>if you are trying to create a bar chart using x and y variables contained in your data set, you need to set <code>geom_bar(stat = &quot;identity&quot;)</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a bar plot of genus from by_month_genus using y = captures and </span>
<span class="co"># stat = &quot;identity&quot;</span>
<span class="kw">ggplot</span>(by_month_genus) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> genus, <span class="dt">y =</span> captures,
                         <span class="dt">fill=</span>rodent_type), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(~<span class="st"> </span>plot_type)</code></pre></div>
<p><img src="img/r-lesson-by_month_bar_2-1.png" width="672" /></p>
<blockquote>
<h3 id="challenge-2">Challenge</h3>
<p>Let’s compare the plot we just made with <code>by_month_genus</code> to one using <code>surveys_subset</code></p>
<p>Use the code from the plot where we didn’t use the <code>captures</code> column and use the default statistical transformation.</p>
<p>As <code>surveys_subset</code> has one row for every capture, counting the rows should produce the same plot as when we used the calculated <code>captures</code> column in <code>by_month_genus</code>.</p>
</blockquote>
<p>To learn more about the 20 statistical transformations built into ggplot2 have a look at the <a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf">ggplot2 cheatsheet</a>.</p>
<blockquote>
<h3 id="challenge-3">Challenge</h3>
<p>For the next part we need to calculaute the mean monthly captures.</p>
<p>Recall how to do grouped summaries and create an object <code>by_month_mean</code> using <code>by_month_genus</code>, grouping by <code>genus,plot_type,rodent_type</code> and then summarising <code>mean_captures = mean(captures)</code>.</p>
</blockquote>
<p>Using our new summary data frame <code>by_month_mean</code> we’ll look at using positions with bar charts.</p>
<p>The next few graphs illustrate a stacked bar chart situation. Here we plot the mean monthly number of captures at each plot type, colouring by genus.</p>
<p>In the first plot the bars are stacked such that we can see the relative mean monthly captures per genus, but not what the actual mean was for each genus.</p>
<p>To get round this problem we can alter the default position setting to identity. However, this means that filled bars would overlap, so we’ve set <code>fill = NA</code>. Now we can see the mean values as well as the proportions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a stacked bar chart of plot type coloured by genus</span>
<span class="kw">ggplot</span>(by_month_mean) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> plot_type, <span class="dt">y =</span> mean_captures, 
                         <span class="dt">colour =</span> genus),
           <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="img/r-lesson-by_month_bar_3-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use position = &quot;identitiy&quot; to create overlapping bars</span>
<span class="kw">ggplot</span>(by_month_mean) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> plot_type, <span class="dt">y =</span> mean_captures, 
                         <span class="dt">colour =</span> genus),
           <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span><span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="img/r-lesson-by_month_bar_3-2.png" width="672" /></p>
<p>Alternatively we could set <code>postion = dodge</code> and we get the next plot, where the bars for each genus are side by side, again allowing us to see both the proportions and the mean values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use position = &quot;dodge&quot; to create side by side bars</span>
<span class="kw">ggplot</span>(by_month_mean) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> plot_type, <span class="dt">y =</span> mean_captures, 
                         <span class="dt">colour =</span> genus),
           <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span><span class="st">&quot;dodge&quot;</span>)</code></pre></div>
<p><img src="img/r-lesson-by_month_bar_4-1.png" width="672" /></p>
<p>For more positional adjustments, check out the help files <code>?postion_jitter</code>, <code>?position_dodge</code>, <code>?position_fill</code>, <code>?position_identity</code>, and <code>?position_stack</code>.</p>
</div>
<div id="coordinate-adjustments" class="section level3">
<h3>Coordinate adjustments</h3>
<p>Previously, we plotted <code>by_month_genus</code> and the genus labels we overlapping. We could change the label size, but to illustrate another function, let’s flip the plot round using <code>coord_flip()</code> to improve things:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Flip the coordinates to make the labels readable </span>
<span class="kw">ggplot</span>(by_month_genus) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> genus, <span class="dt">y =</span> captures, <span class="dt">fill =</span> rodent_type), 
           <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(~<span class="st"> </span>plot_type) +
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="img/r-lesson-by_month_bar_5-1.png" width="672" /></p>
</div>
<div id="factors" class="section level3">
<h3>Factors</h3>
<p>Finally for this plot, it would be nice to put the bars in order of size. We can do this by converting the genus to a factor.</p>
<p>Recall that factors are how R represents categorical variables, variables with a limited number of values, such as genus.</p>
<p>Also recall <strong>factors look like strings, but behave like integers</strong>. That is to say they are strings of characters with associated values called levels that can be used to order catergories.</p>
<p>This is why factors are useful, especially when we want to place things in non-alphabetical order. We can take advantage of factor levels to order things as we wish.</p>
<p>Check out the <a href="http://forcats.tidyverse.org/">forcats</a> tidyverse package to explore the power of factors, but here to give you a taste of what is possible we’re going to use the <code>forcats</code> package <code>fct_reorder()</code> function to convert <code>genus</code> into a factor and in doing so set the level according to to the number of captures. In this way we can order the bars in our plot according to the number of captures and see the pattern more clearly.</p>
<p>In <code>fct_reorder()</code>, the first argument is the variable we wish to make into a factor <code>genus</code>, and the second argument is variable we wish to use to create the order. Here we want to order according to the number of captures, so <code>captures</code> is the second argument.</p>
<p>Note we still keep x and y mappings, but now x is now a function of both the genus and the capture columns.</p>
<p>This gives us a nice ordered bar chart by genus and number of captures during the experimental period.</p>
<p><strong>We can clearly see that kangaroo rat exclosure works, and that this corresponds with an increase in granivore captures these plots.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the forcats tidyverse package</span>
<span class="kw">library</span>(forcats)

<span class="co"># Order the rodents according to number of captures</span>
<span class="kw">ggplot</span>(by_month_genus) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(genus, captures), <span class="dt">y =</span> captures, 
                          <span class="dt">fill =</span> rodent_type), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(~<span class="st"> </span>plot_type) +
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="img/r-lesson-by_month_bar_6-1.png" width="672" /></p>
<blockquote>
<h3 id="challenge-4">Challenge</h3>
<p>To illustrate using the size aesthetic and factors, recreate the <code>by_month_mean</code> plot using geom_point() with the additional argument of <code>size = rodent_type</code>.</p>
<p>Use <code>fct_reorder()</code> to change the x mapping to a factor that is a function of <code>genus</code> and <code>mean_captures</code> such that the plot is ordered by <code>mean_captures</code>.</p>
<p>Don’t forget to change <code>fill</code> to <code>colour</code> when changing from <code>geom_bar()</code> to <code>geom_point()</code>.</p>
</blockquote>
</div>
</div>
<div id="themes-and-customisations" class="section level2">
<h2>Themes and customisations</h2>
<p>When we’re exploring our data we generally don’t mind if the labels and colours etc… are a bit messy. But when we want to publish or communicate our findings to others we want everything to be just so.</p>
<p>This is where the code can become quite complicated and it’s hard to provide a general case. However, the underlying template remains the same:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> &lt;DATA&gt;) +<span class="st"> </span>
<span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION&gt;(
     <span class="dt">mapping =</span> <span class="kw">aes</span>(&lt;MAPPINGS&gt;),
     <span class="dt">stat =</span> &lt;STAT&gt;, 
     <span class="dt">position =</span> &lt;POSITION&gt;
<span class="st">  </span>) +
<span class="st">  </span><span class="er">&lt;</span>COORDINATE_FUNCTION&gt;<span class="st"> </span>+
<span class="st">  </span><span class="er">&lt;</span>FACET_FUNCTION&gt;</code></pre></div>
<p>It’s unlikely that you’ll need to statistical transformations, positional adjustments, coordinate adjustments, and facets all in the same plot, but this provides an idea of what is possible. Remember the aim is clarity, not to make something complicated just because you can.</p>
<p>This template we can use to add all the additional functions and arguments that will change the plot to make it exactly how we want. It takes time, but remember code is reusable. Solve it once and you’ve solved it forever.</p>
<p>For all the possible customisations check out the <a href="http://ggplot2.tidyverse.org/reference/index.html">ggplot2 documentation</a>, and this chapter of R for data science: <a href="http://r4ds.had.co.nz/graphics-for-communication.html#themes">Graphics for communication</a></p>
<p>But here’s a few common changes.</p>
<div id="changing-colours-labels-themes-and-adding-titles" class="section level3">
<h3>Changing colours, labels, themes and adding titles</h3>
<p>Recall our box-plot with points overlaid. Following the facet function, we’re going add a succession of functions to change the colours <code>scale_colour_brewer()</code>, change the axis labels, add a title using <code>labs()</code> and change the theme.</p>
<p>Themes deal with non-data elements e.g. the grid, the axes etc. There are a range of built-in themes and packages of themes such as <code>ggthemes</code>. Here we’ll use the built-in theme, <code>theme_bw()</code> that gives a simple layout.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span> by_quarter,
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rodent_type, <span class="dt">y =</span> captures, 
                     <span class="dt">colour =</span> rodent_type)) +
<span class="st">  </span><span class="kw">geom_boxplot</span>() +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="st">&quot;jitter&quot;</span>) +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>plot_type) +
<span class="st">  </span><span class="kw">scale_colour_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Quarterly average captures of rodents between 1977 and 1990&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Rodent type&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Number of captures&quot;</span>,
       <span class="dt">colour =</span> <span class="st">&quot;Rodent type&quot;</span>) +
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="img/r-lesson-by_quarter_box_4-1.png" width="672" /></p>
<p>Check out <code>?scale_colour_brewer</code> and <code>?scale_fill_brewer</code> for more information on colour schemes for discrete data. And <code>?scale_color_continuous</code> for creating colour gradients for continuous data.</p>
</div>
</div>
<div id="recreating-the-paper-figure" class="section level2">
<h2>Recreating the paper figure</h2>
<p>With a fair amount of extra code we can mostly re-create the figure from the paper (top two panels only). Interestingly, the shape of the data is not identitical in both plots, suggesting that there are differences in the datasets used to generate these plots. This doesn’t mean our plot is incorrect or more correct, but emphasises two issues:</p>
<ol style="list-style-type: decimal">
<li><p>Raw data is simply the form you receive it in. Raw does not mean that the data has not been transformed previously. Hence it is likely that there are differences between the raw dataset we have, and the dataset used for the paper.</p></li>
<li><p>Why scripts are so useful if you want to reproduce an analysis. There is no script available for the paper figure, so we cannot check how it was generated. But our figure is in principal reproducible by anyone capable of running our script.</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create rodent levels by getting the unique values for rodent type</span>
<span class="co"># and putting them in reverse order for plotting</span>
rodent_levels &lt;-<span class="st">  </span><span class="kw">rev</span>(<span class="kw">unique</span>(by_quarter$rodent_type))

<span class="co"># Convert rodent_type to factors such that Kangeroo rat is first and Granivore</span>
<span class="co"># is second</span>
by_quarter$rodent_type &lt;-<span class="st"> </span><span class="kw">factor</span>(by_quarter$rodent_type, 
                                 <span class="dt">levels =</span> rodent_levels)

<span class="co"># Now recreate the published figure in black and white</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> by_quarter,<span class="kw">aes</span>(<span class="dt">x=</span>quarter, <span class="dt">y=</span>captures, <span class="dt">linetype =</span> plot_type,
                             <span class="dt">shape =</span> plot_type)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>rodent_type, <span class="dt">nrow =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1978</span>,<span class="dv">1990</span>,<span class="dv">2</span>)) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span><span class="st">&quot;YEAR&quot;</span>,
       <span class="dt">y =</span><span class="st">&quot;CAPTURES / PERIOD&quot;</span>,
       <span class="dt">linetype =</span> <span class="st">&quot;&quot;</span>,
       <span class="dt">shape =</span> <span class="st">&quot;&quot;</span>) +
<span class="st">  </span><span class="kw">theme_linedraw</span>() +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),
        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),
        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>),
        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),
        <span class="dt">aspect.ratio =</span> <span class="fl">0.6</span>, 
        <span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</code></pre></div>
<p><img src="img/r-lesson-paper_figure-1.png" width="672" /></p>
<div class="figure">
<img src="./img/HeskeBrown&amp;Mistry1994E_Fig_1.png" alt="Figure 1 from Heske et. al., 1994" />
<p class="caption">Figure 1 from Heske et. al., 1994</p>
</div>
<p>If you are preparing figures for a manuscript or publication, it’s worth checking out the <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html">cowplot</a> package that works with ggplot2. This enables easy combinations of different plots and things like panel labels.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>Below is our final template for creating plots with ggplot2.</p>
<p>To reiterate, often the default functions with no extra arguments are sufficient to create the plot we need. But there is a great deal we can change if we need to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> &lt;DATA&gt;) +<span class="st"> </span>
<span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION&gt;(
     <span class="dt">mapping =</span> <span class="kw">aes</span>(&lt;MAPPINGS&gt;),
     <span class="dt">stat =</span> &lt;STAT&gt;, 
     <span class="dt">position =</span> &lt;POSITION&gt;
<span class="st">  </span>) +
<span class="st">  </span><span class="er">&lt;</span>COORDINATE_FUNCTION&gt;<span class="st"> </span>+
<span class="st">  </span><span class="er">&lt;</span>FACET_FUNCTION&gt;<span class="st"> </span>+
<span class="st">  </span><span class="er">&lt;</span>LABEL FUNCTION&gt;<span class="st"> </span>+
<span class="st">  </span><span class="er">&lt;</span>THEME FUNCTION&gt;</code></pre></div>
<p>Moreover, we have written code for our plot. It’s now both reusable and reproducible. This is good for spotting errors, or if we are making the same plots on a regular basis we could even start thinking about how to automate this process. Thirdly, when making plots for publication we can easily amend the code to change the appearance of a plot with minimal effort.</p>
<p>In the final part of this lesson we’ll cover exporting figures, and how to turn everything we’ve done into a report. minimal effort if our collaborators or an editor</p>
</div>

<hr/>

<p><a href="http://datacarpentry.org/">Data Carpentry</a>, 2017. <br/>
  <a href="LICENSE.html">License</a>. Questions?  Feedback?
  Please <a href="https://github.com/datacarpentry/R-ecology-lesson/issues/new">file
    an issue on GitHub</a>. <br/>
  On Twitter: <a href="https://twitter.com/datacarpentry">@datacarpentry</a></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
