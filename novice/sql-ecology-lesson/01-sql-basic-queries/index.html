<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2017-04-05 12:43:11 +0100">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-dc.ico" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>SQL for Ecology: Basic Queries</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../00-sql-introduction/">Databases using SQL</a></li>
            
            <li><a href="../01-sql-basic-queries/">Basic Queries</a></li>
            
            <li><a href="../02-sql-aggregation/">SQL Aggregation</a></li>
            
            <li><a href="../03-sql-joins-aliases/">Joins and aliases</a></li>
            
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
	
	<li><a href="/edit/gh-pages/_episodes/01-sql-basic-queries.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../00-sql-introduction/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">SQL for Ecology</a></h3>
    <h1 class="maintitle">Basic Queries</h1>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../02-sql-aggregation/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br/>
      <strong>Exercises:</strong> 5 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>Learning Basic Queries in SQL</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Write and build queries.</p>
</li>
	
	<li><p>Filter data given various criteria.</p>
</li>
	
	<li><p>Sort the results of a query.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="learning-objectives">Learning objectives</h2>
<ol>
  <li>Write and build queries.</li>
  <li>Filter data given various criteria.</li>
  <li>Sort the results of a query.</li>
</ol>

<h2 id="writing-my-first-query">Writing my first query</h2>

<p>Let’s start by using the <strong>surveys</strong> table. Here we have data on every
individual that was captured at the site, including when they were captured,
what plot they were captured on, their species ID, sex and weight in grams.</p>

<p>Let’s write an SQL query that selects only the year column from the
surveys table. SQL queries can be written in the box located under 
the “Execute SQL” tab. Click ‘Run SQL’ to execute the query in the box.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT year
FROM surveys;
</code></pre>
</div>

<p>We have capitalized the words SELECT and FROM because they are SQL keywords.
SQL is case insensitive, but it helps for readability, and is good style.</p>

<p>If we want more information, we can just add a new column to the list of fields,
right after SELECT:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT year, month, day
FROM surveys;
</code></pre>
</div>

<p>Or we can select all of the columns in a table using the wildcard *</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM surveys;
</code></pre>
</div>

<h3 id="unique-values">Unique values</h3>

<p>If we want only the unique values so that we can quickly see what species have
been sampled we use <code class="highlighter-rouge">DISTINCT</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT DISTINCT species_id
FROM surveys;
</code></pre>
</div>

<p>If we select more than one column, then the distinct pairs of values are
returned</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT DISTINCT year, species_id
FROM surveys;
</code></pre>
</div>

<h3 id="calculated-values">Calculated values</h3>

<p>We can also do calculations with the values in a query.
For example, if we wanted to look at the mass of each individual
on different dates, but we needed it in kg instead of g we would use</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT year, month, day, weight/1000
FROM surveys;
</code></pre>
</div>

<p>When we run the query, the expression <code class="highlighter-rouge">weight / 1000</code> is evaluated for each
row and appended to that row, in a new column. If we used the <code class="highlighter-rouge">INTEGER</code> data type
for the weight field then integer division would have been done, to obtain the
correct results in that case divide by <code class="highlighter-rouge">1000.0</code>. Expressions can use any fields,
any arithmetic operators (<code class="highlighter-rouge">+</code>, <code class="highlighter-rouge">-</code>, <code class="highlighter-rouge">*</code>, and <code class="highlighter-rouge">/</code>) and a variety of built-in
functions. For example, we could round the values to make them easier to read.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT plot_id, species_id, sex, weight, ROUND(weight / 1000, 2)
FROM surveys;
</code></pre>
</div>

<blockquote class="challenge">
  <h2 id="challenge">Challenge</h2>

  <ul>
    <li>Write a query that returns The year, month, day, species_id and weight in mg</li>
  </ul>
</blockquote>

<h2 id="filtering">Filtering</h2>

<p>Databases can also filter data – selecting only the data meeting certain
criteria.  For example, let’s say we only want data for the species
<em>Dipodomys merriami</em>, which has a species code of DM.  We need to add a
<code class="highlighter-rouge">WHERE</code> clause to our query:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM surveys
WHERE species_id='DM';
</code></pre>
</div>

<p>We can do the same thing with numbers.
Here, we only want the data since 2000:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT * FROM surveys
WHERE year &gt;= 2000;
</code></pre>
</div>

<p>If we used the <code class="highlighter-rouge">TEXT</code> data type for the year the <code class="highlighter-rouge">WHERE</code> clause should
be <code class="highlighter-rouge">year &gt;= '2000'</code>. We can use more sophisticated conditions by combining tests
with <code class="highlighter-rouge">AND</code> and <code class="highlighter-rouge">OR</code>.  For example, suppose we want the data on <em>Dipodomys merriami</em>
starting in the year 2000:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM surveys
WHERE (year &gt;= 2000) AND (species_id = 'DM');
</code></pre>
</div>

<p>Note that the parentheses are not needed, but again, they help with
readability.  They also ensure that the computer combines <code class="highlighter-rouge">AND</code> and <code class="highlighter-rouge">OR</code>
in the way that we intend.</p>

<p>If we wanted to get data for any of the <em>Dipodomys</em> species, which have
species codes <code class="highlighter-rouge">DM</code>, <code class="highlighter-rouge">DO</code>, and <code class="highlighter-rouge">DS</code>, we could combine the tests using OR:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM surveys
WHERE (species_id = 'DM') OR (species_id = 'DO') OR (species_id = 'DS');
</code></pre>
</div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge</h2>

  <ul>
    <li>Write a query that returns the day, month, year, species_id, and
weight (in kg) for individuals caught on Plot 1 that weigh more than 75 g</li>
  </ul>
</blockquote>

<h2 id="building-more-complex-queries">Building more complex queries</h2>

<p>Now, lets combine the above queries to get data for the 3 <em>Dipodomys</em> species from
the year 2000 on.  This time, let’s use IN as one way to make the query easier
to understand.  It is equivalent to saying <code class="highlighter-rouge">WHERE (species_id = 'DM') OR (species_id
= 'DO') OR (species_id = 'DS')</code>, but reads more neatly:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM surveys
WHERE (year &gt;= 2000) AND (species_id IN ('DM', 'DO', 'DS'));
</code></pre>
</div>

<p>We started with something simple, then added more clauses one by one, testing
their effects as we went along.  For complex queries, this is a good strategy,
to make sure you are getting what you want.  Sometimes it might help to take a
subset of the data that you can easily see in a temporary database to practice
your queries on before working on a larger or more complicated database.</p>

<p>When the queries become more complex, it can be useful to add comments. In SQL,
comments are started by <code class="highlighter-rouge">--</code>, and end at the end of the line. For example, a
commented version of the above query can be written as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-- Get post 2000 data on Dipodomys' species
-- These are in the surveys table, and we are interested in all columns
SELECT * FROM surveys
-- Sampling year is in the column `year`, and we want to include 2000
WHERE (year &gt;= 2000)
-- Dipodomys' species have the `species_id` DM, DO, and DS
AND (species_id IN ('DM', 'DO', 'DS'));
</code></pre>
</div>

<p>Although SQL queries often read like plain English, it is <em>always</em> useful to add
comments; this is especially true of more complex queries.</p>

<h2 id="sorting">Sorting</h2>

<p>We can also sort the results of our queries by using <code class="highlighter-rouge">ORDER BY</code>.
For simplicity, let’s go back to the <strong>species</strong> table and alphabetize it by taxa.</p>

<p>First, let’s look at what’s in the <strong>species</strong> table. It’s a table of the species_id and the full genus, species and taxa information for each species_id. Having this in a separate table is nice, because we didn’t need to include all
this information in our main <strong>surveys</strong> table.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM species;
</code></pre>
</div>

<p>Now let’s order it by taxa.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM species
ORDER BY taxa ASC;
</code></pre>
</div>

<p>The keyword <code class="highlighter-rouge">ASC</code> tells us to order it in Ascending order.
We could alternately use <code class="highlighter-rouge">DESC</code> to get descending order.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM species
ORDER BY taxa DESC;
</code></pre>
</div>

<p><code class="highlighter-rouge">ASC</code> is the default.</p>

<p>We can also sort on several fields at once.
To truly be alphabetical, we might want to order by genus then species.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT *
FROM species
ORDER BY genus ASC, species ASC;
</code></pre>
</div>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge</h2>

  <ul>
    <li>Write a query that returns year, species_id, and weight in kg from
the surveys table, sorted with the largest weights at the top.</li>
  </ul>
</blockquote>

<h2 id="order-of-execution">Order of execution</h2>

<p>Another note for ordering. We don’t actually have to display a column to sort by
it.  For example, let’s say we want to order the birds by their species ID, but
we only want to see genus and species.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELECT genus, species
FROM species
WHERE taxa = 'Bird'
ORDER BY species_id ASC;
</code></pre>
</div>

<p>We can do this because sorting occurs earlier in the computational pipeline than
field selection.</p>

<p>The computer is basically doing this:</p>

<ol>
  <li>Filtering rows according to WHERE</li>
  <li>Sorting results according to ORDER BY</li>
  <li>Displaying requested columns or expressions.</li>
</ol>

<p>Clauses are written in a fixed order: <code class="highlighter-rouge">SELECT</code>, <code class="highlighter-rouge">FROM</code>, <code class="highlighter-rouge">WHERE</code>, then <code class="highlighter-rouge">ORDER
BY</code>. It is possible to write a query as a single line, but for readability,
we recommend to put each clause on its own line.</p>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge</h2>

  <ul>
    <li>Let’s try to combine what we’ve learned so far in a single
query.  Using the surveys table write a query to display the three date fields,
<code class="highlighter-rouge">species_id</code>, and weight in kilograms (rounded to two decimal places), for
individuals captured in 1999, ordered alphabetically by the <code class="highlighter-rouge">species_id</code>.</li>
    <li>Write the query as a single line, then put each clause on its own line, and
see how more legible the query becomes!</li>
  </ul>
</blockquote>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
  </ul>
</blockquote>


<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../00-sql-introduction/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../02-sql-aggregation/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2017
	
	<a href="http://datacarpentry.org">Data Carpentry</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	
	<a href="/edit/gh-pages/_episodes/01-sql-basic-queries.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:lessons@software-carpentry.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
